var colors=["#ff8229","#87cefa","#da70d6","#32cd32","#6495ed","#ff69b4","#ba55d3","#cd5c5c","#ffa500","#40e0d0","#1e90ff","#ff6347","#7b68ee","#00fa9a","#ffd700","#6b8e23","#ff00ff","#3cb371","#b8860b","#30e0e0"],service=axios.create({baseURL:site_url,timeout:5e3}),WAITING_TIME=90,myChart=null,totalTime=2e3,initVelocity=360/(totalTime/2),initVelocity1=720/(totalTime/2),beta=0,curTimer=null,curTime=0,jackpanel,firework_timer=null,firework_index=1,user_anim_index=1,userDataForChart=[],WINNER_ID=-1,app=new Vue({el:"#main-container",data:{my_id:0,deposited_amount:0,winning_chance:0,game:{ID:12,HASH:"1234567813",TOTAL_BETTING_AMOUNT:0,TIME_LEFT:WAITING_TIME,STARTED:!1},last_bet_id:0,flag_sound:!0,flag_loaded:!1,bets:[{USERID:1,USERNAME:"Karlson",AVATAR:"",BET_AMOUNT:1e3,CHANCE:0,COLOR:"#FFF"}],last_winner:{AVATAR:"",USERNAME:"Karlson",BET_AMOUNT:150,WIN_CHANCE:29},last_winner_exist:!1,input_deposit:"",deposits:["+1K","+10K","+100K","1/2","X2","MAX"]},created:function(){this.refresh()},computed:{formatted_time:function(){var str=Math.floor(this.game.TIME_LEFT/60)+":";return this.game.TIME_LEFT%60<10&&(str+="0"),str+=this.game.TIME_LEFT%60},reversed_bets:function(){for(var t_arr=[],index=this.bets.length-1;index>=0;index-=1)t_arr.push(this.bets[index]);return t_arr},style_time_left:function(){return"width: "+Math.floor(this.game.TIME_LEFT/WAITING_TIME*200)+"px;"},style_time_gone:function(){return"width: "+Math.floor((WAITING_TIME-this.game.TIME_LEFT)/WAITING_TIME*200)+"px;"},growthData:function(){return{labels:this.monthly.GrowthLabels,datasets:[{label:"Growth",type:"line",data:this.monthly.Growth,fill:!1,lineTension:0,backgroundColor:"rgba(0,192,255,0.7)",borderWidth:1,borderColor:"rgba(0,50,255,1)",borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",pointBorderColor:"rgba(75,192,192,1)",pointBackgroundColor:"#fff",pointBorderWidth:0,pointHoverRadius:5,pointHoverBackgroundColor:"rgba(75,192,192,1)",pointHoverBorderColor:"rgba(220,220,220,1)",pointHoverBorderWidth:2,pointRadius:0,pointHitRadius:10}]}},drawdownData:function(){return{labels:this.monthly.DrawdownLabels,datasets:[{label:"Drawdown",data:this.monthly.Drawdown,lineTension:0,backgroundColor:"rgba(0,192,255,0.7)",borderWidth:.5,borderColor:"rgba(0,50,255,1)",borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",pointBorderColor:"rgba(75,192,192,1)",pointBackgroundColor:"#fff",pointBorderWidth:0,pointHoverRadius:5,pointHoverBackgroundColor:"rgba(75,192,192,1)",pointHoverBorderColor:"rgba(220,220,220,1)",pointHoverBorderWidth:2,pointRadius:0,pointHitRadius:10}]}}},methods:{refresh:function(){var self=this;self.flag_loaded=!1,send_request("jackpot/ajax_round_info",function(resp){if(resp.status){self.my_id=resp.userid,self.deposited_amount=resp.deposited_amount,self.game=resp.game;var total_betting=parseInt(self.game.TOTAL_BETTING_AMOUNT);if(self.winning_chance=total_betting?Math.floor(self.deposited_amount/total_betting*1e4)/100:0,resp.last_winner?(self.last_winner_exist=!0,self.last_winner=resp.last_winner):self.last_winner_exist=!1,resp.bets){for(;self.bets.length>0;)self.bets.pop();for(var i=0;i<resp.bets.length;i+=1){var t_bet=resp.bets[i];t_bet.AVATAR=base_url+resp.bets[i].AVATAR,t_bet.CHANCE=Math.floor(t_bet.BET_AMOUNT/self.game.TOTAL_BETTING_AMOUNT*1e4)/100,t_bet.COLOR=colors[i%colors.length],self.bets.push(t_bet)}}else self.bets=[];self.input_deposit="",self.flag_loaded=!0,self.game.STARTED?self.start_timer():render_time_bar(),$("#myChart").css("-ms-transform",""),$("#myChart").css("-webkit-transform",""),$("#myChart").css("transform",""),BettingPanel.refresh()}else console.log(" Error occurred on jackpot/ajax_round_info ")})},clear_deposit_input:function(){this.input_deposit=""},on_deposit_1:function(key){switch(this.input_deposit*=1,key){case"+1K":this.input_deposit+=1e3;break;case"+10K":this.input_deposit+=1e4;break;case"+100K":this.input_deposit+=1e5;break;case"1/2":this.input_deposit/=2;break;case"X2":this.input_deposit*=2;break;case"MAX":this.on_max();break;default:console.log("Error Occured")}},on_max:function(){var self=this;send_request("jackpot/ajax_max_amount",function(resp){resp.status?self.input_deposit=resp.wallet:"You have to login first."==resp.msg&&(window.location.href=site_url+"Login")})},on_deposit:function(){var deposit_amount=1*this.input_deposit;if(0!=deposit_amount){var self=this;send_request("jackpot/ajax_deposit",function(resp){resp.status?self.clear_deposit_input():("You have to login first."==resp.msg&&(window.location.href=site_url+"Login"),"Round is already finished"==resp.msg?(alert(resp.msg),self.refresh()):alert(resp.msg))},{deposit_amount:deposit_amount,game_id:self.game.ID})}else alert("Please input correct value")},refresh_history:function(){var self=this;send_request("jackpot/ajax_after_bets/"+this.last_bet_id,function(resp){resp.status?(self.bets=resp.bets,self.last_bet_id=resp.last_bet_id):console.log(resp.msg)})},start_timer:function(){this.timer_id=setInterval(this.time_down,1e3)},time_down:function(){if(this.game.TIME_LEFT<=0)return this.timer_id&&clearInterval(this.timer_id),void(this.timer_id=0);render_time_bar(),this.game.TIME_LEFT-=1,0==this.game.TIME_LEFT&&(clearInterval(this.timer_id),this.timer_id=0,this.get_winner())},get_winner:function(){var self=this;send_request("jackpot/ajax_get_winner/"+this.game.ID,function(resp){resp.status?(self.game.WINNER=resp.winner,BettingPanel.show_winner(resp.winner,resp.angle)):console.log(resp.msg)})},new_bet:function(bet_data){bet_data.USERID==this.my_id&&(this.deposited_amount=1*this.deposited_amount+1*bet_data.BET_AMOUNT),this.game.TOTAL_BETTING_AMOUNT=1*this.game.TOTAL_BETTING_AMOUNT+1*bet_data.BET_AMOUNT,this.winning_chance=Math.floor(this.deposited_amount/this.game.TOTAL_BETTING_AMOUNT*1e4)/100;for(var i=0;i<this.bets.length;i+=1)if(this.bets[i].USERID==bet_data.USERID){var t_bet_amount=bet_data.BET_AMOUNT,t_arr;(bet_data=this.bets.splice(i,1)[0]).BET_AMOUNT=1*bet_data.BET_AMOUNT+1*t_bet_amount;break}bet_data.COLOR||(bet_data.COLOR=colors[this.bets.length%colors.length]),this.bets.push(bet_data);for(var i=0;i<this.bets.length;i+=1)this.bets[i].CHANCE=Math.floor(this.bets[i].BET_AMOUNT/this.game.TOTAL_BETTING_AMOUNT*1e4)/100;this.bets.length>1&&!this.game.STARTED&&(this.game.STARTED=!0,this.start_timer()),BettingPanel.refresh()}}});function send_request(url,process=function(resp){},data=!1){service.request({url:site_url+url,method:"POST",params:data}).then(function(result){process(result.data)})}var FireWorks=function(){var firework_index=0,firework_timer=0,user_anim_index=0,fireworksFunc=function(){if(firework_index>90){clearInterval(firework_timer);for(var i=0;i<app.bets.length&&app.bets[i].USERID!=app.game.WINNER;i+=1);return alert("Winner is "+app.bets[i].USERNAME),void app.refresh()}$("#fireworks").removeClass("firework"+(firework_index-1)),$("#fireworks").addClass("firework"+(firework_index+1)),firework_index+=1,user_anim_index>56||($(".fire.animFL").show().removeClass("afwin"+(user_anim_index-1)).addClass("afwin"+user_anim_index),$(".fire.animWL").show().removeClass("afwin"+(user_anim_index-1)).addClass("afwin"+user_anim_index),user_anim_index+=1)};return{start:function(){setTimeout(function(){$(".fire").addClass("animFL"),firework_timer=setInterval(fireworksFunc,50)},500)}}},pieR=220,BettingPanel=function(){var angle;return{refresh:function(){this.initChart()},show_winner:function(winner_id,totalAngle){WINNER_ID=winner_id,beta=calcA(totalAngle),curTimer=setInterval(this.rotate,10)},rotate:function(){if(0!=beta){var rotate="rotate("+(angle=(curTime+=10)<totalTime/2?initVelocity1*curTime:initVelocity*curTime-beta*curTime*curTime/2)+"deg)";$("#myChart").css("-ms-transform",rotate),$("#myChart").css("-webkit-transform",rotate),$("#myChart").css("transform",rotate),curTime>=totalTime&&(clearInterval(curTimer),app.my_id==WINNER_ID?firework_timer=setInterval(BettingPanel.fireworksFunc,50):setTimeout(app.refresh,550),curTimer=null,curTime=0,beta=0)}},fireworksFunc:function(){if(firework_index>90)return clearInterval(firework_timer),firework_index=1,user_anim_index=1,void app.refresh();$("#fireworks").removeClass("firework"+(firework_index-1)),$("#fireworks").addClass("firework"+firework_index),firework_index++,user_anim_index>56||($(".fire.animFL").show().removeClass("afwin"+(user_anim_index-1)).addClass("afwin"+user_anim_index),$(".fire.animWL").show().removeClass("afwin"+(user_anim_index-1)).addClass("afwin"+user_anim_index),user_anim_index++)},initChart:function(){for(var ctx=document.getElementById("myChart"),betting=[],backgroundColor=[],labels=[],i=0;i<app.bets.length;i+=1)betting.push(app.bets[i].BET_AMOUNT),backgroundColor.push(colors[i%colors.length]),labels.push(app.bets[i].USERNAME);var config={type:"doughnut",data:{datasets:[{data:betting,backgroundColor:backgroundColor,borderWidth:0}]},options:{cutoutPercentage:82,label:{display:!1}}};null!=jackpanel&&(jackpanel.destroy(),jackpanel=void 0),jackpanel=new Chart(ctx,config)}}}();function calcA(totalAngle){var a;return 2*(initVelocity*totalTime-totalAngle)/(totalTime*totalTime)}function render_time_bar(){$("#div-time-left").css("width",200*app.game.TIME_LEFT/90),app.game.TIME_LEFT>10?$("#div-time-left").css("border","solid 5px #c989fa"):$("#div-time-left").css("border","solid "+app.game.TIME_LEFT/2+"px #c989fa"),$("#div-time-elapsed").css("width",200*(90-app.game.TIME_LEFT)/90),app.game.TIME_LEFT<85?$("#div-time-elapsed").css("border","solid 3px #462f69"):$("#div-time-elapsed").css("border","solid "+(90-app.game.TIME_LEFT)/2+"px #462f69")}